{% extends 'data_capture/step.html' %}

{% block body_class %}secondary-step card--wide card--no-header{% endblock %}

{% block step_heading %}
  <h2>Price list analysis</h2>
  {% if gleaned_data.valid_rows %}
    <p>Below is the analysis of your price list.</p>
    {% endif %}
{% endblock %}
{% block step_body %}
  {% if gleaned_data.valid_rows %}
    <table class="price-list-table analysis">
        <thead>
          <tr>
            <th>Service proposed</th>
            <th>Min.<br />edu.</th>
            <th>Min.<br />exper.</th>
            <th># of results</th>
            <th>Proposed<br />price</th>
            <th>Average<br />price</th>
            <th>+/- avg.</th>
            <th>% +/- avg.</th>
            <th>+/- std. dev.</th>
          </tr>
        </thead>
        <tbody>
        {% for row in analyzed_rows %}
          <tr>
            <td><a href={{ row.analysis.url }} target="_blank">{{ row.labor_category }}</a></td>
            <td>{{ row.education_level }}</td>
            <td>{{ row.min_years_experience }}</td>
            <td><a href={{ row.analysis.url }} target="_blank">{{ row.analysis.count }}</a></td>
            <td class="number">${{ row.price|floatformat:2 }}</td>
            <td class="number">${{ row.analysis.avg|floatformat:2 }}</td>
            <td>
             {% if row.analysis.preposition == 'above' %}
                +
              {% elif row.analysis.preposition == 'below' %}
                -
              {% endif %}
              <span class="number">
                ${{ row.analysis.dist_from_avg|floatformat:2 }}
              </span>
            </td>
            <td>
              {% if row.analysis.preposition == 'above' %}
                +
              {% elif row.analysis.preposition == 'below' %}
                -
              {% endif %}
              <span class="number">
                {{ row.analysis.dist_from_avg_percent|floatformat:2 }}%
              </span>
            </td>
            <td {% if row.analysis.severe %}class="table-error-severe"{% endif %}>
             {% if row.analysis.preposition == 'above' %}
                +
              {% elif row.analysis.preposition == 'below' %}
                -
              {% endif %}
              {{ row.analysis.stddevs }} std. devs.
            </td>
          </tr>
        {% endfor %}
        </tbody>
    </table>
  {% endif %}

  <div class="form-button-row clearfix">
    <div class="download-group">
      <label>Download analysis:</label>
      <a href="{% url 'data_capture:export_analysis' %}?f=csv" class="usa-button ghost-button csv" download>
        CSV file
      </a>

      <a href="{% url 'data_capture:export_analysis' %}?f=xlsx" class="usa-button ghost-button csv" download>
        Excel file
      </a>
    </div>

    <a href="{% url 'index' %}" class="usa-button usa-button-secondary">CALC home</a>
    <a href="{% url 'data_capture:analyze_step_1' %}" class="usa-button usa-button-primary">Analyze another price list</a>
  </div>
{% endblock %}
